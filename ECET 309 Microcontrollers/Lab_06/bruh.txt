#include <hidef.h>      /* common defines and macros */
#include "derivative.h"      /* derivative-specific definitions */
#include "protos.h"

// Array used to initialize the LCD
const unsigned char lcdArray[] = {0x30,0x30,0x30,0x38,0x0f,0x01,0x06};

// Delay function that does nothing
void Delay(unsigned long int delayVal)
{
   while (delayVal != 0)
   {
      delayVal--; // Do nothing
   }
}

// Function to Initialize the LCD. Calls another function to make it easier
void InitializeLCD(void)
{
   unsigned int index;
   
   // Set PORTK and PORTD as outputs ***IMPORTANT***
   DDRK = 0xFF;
   DDRD = 0xFF;
   
   // Step through array from earlier to initialize LCD
   for(index = 0; index <= 6; index++)
   {
      LCDInit(lcdArray[index]);
   }
}


// Function that passes each character to the LCD one at a time using another
//    function
void Display(unsigned char* message)
{
   // Call a function while passing each character individually until the
   //    string is finished
   unsigned int count;
   for(count = 0; message[count] != 0; count++)
   {
      LCDData(message[count]);
   }
}

// Simplifies the LCD Initialization                                                 
void LCDInit(unsigned char dataVal)
{
   PORTK = dataVal;// Function set: using 8-bit mode
   PORTD_PD5 = 0;// Selected command register
   PORTD_PD6 = 0;// We are writing in data register
   PORTD_PD7 = 1;// Enable H->
   PORTD_PD7 = 0;
   Delay(1000);
}

// Used to pass each character individually until the end of the string
void LCDData(unsigned char stringVal)
{
   PORTK = stringVal;// Move the data “characters” to LCD port
   PORTD_PD5 = 1;// Selected data register
   PORTD_PD6 = 0;// rw low because we want to write
   PORTD_PD7 = 1;// toggle the enable line
   PORTD_PD7 = 0;
   Delay(1000);
}